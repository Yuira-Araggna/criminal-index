#Gunakan LIbrary ini
library(lubridate)
library(readxl)
library(ggplot2)
library(dplyr)
library(reshape2)

##Baca data dari excel
sales_volume = read_xls("UK House price index.xls", sheet = 5)




#Hapus baris pertama
sales_volume = sales_volume[-c(1),]


#Hapus kolom yang tidak mempunyai value / null
sales_volume = sales_volume[ , apply(sales_volume, 2, function(x) !any(is.na(x)))]


#Ubah nama kolom pertama menjadi Date
names(sales_volume)[names(sales_volume) == names(sales_volume)[1]] = "Date"


#Pisahkan date pada dataframe sales_volume ke dataframe baru
dates = sales_volume$Date
dates = as.data.frame(dates)


#Pisahkan area perumahan kedalam dataframe baru, lalu gabungkan dates dan area perumahan
area_perum = sales_volume[35:45]
area_perum = cbind(dates, area_perum)

perum = sales_volume[2:34]
perum = cbind(dates,perum)

#Untuk perumahan, ubah dahulu dates menjadi hanya tahun, kemudian ubah semua kolom menjadi tipe numeric
perum$dates = year(perum$dates)
perum = as.data.frame(lapply(perum, as.numeric))

#Ubah tipe kolom pertama menjadi date lalu ubah nama kolom menjadi Date
area_perum$dates = as.Date(area_perum$dates)
names(area_perum)[names(area_perum) == names(area_perum)[1]] = "Date"


names(perum)[names(perum) == names(perum)[1]] = "Date"

#Ubah format pada kolom date hanya menjadi tahun
area_perum$Date = year(area_perum$Date)



#Cari jumlah pembelian pada tiap area dikelompokkan berdasarkan tahun
sums = aggregate(area_perum[,-1], by=list(Date=area_perum$Date), sum)

sum_perum = aggregate(perum[,-1], by=list(Date=perum$Date), sum)


#Melt dataframe menjadi dataframe baru dengan format tahun, nama area, jumlah pembelian
new_sum = melt(sums, id.vars = 'Date', variable.name = 'series')

new_sum_perum = melt(sum_perum, id.vars = 'Date', variable.name = 'series')

#Visualisasikan menggunakan line plot
ggplot(new_sum, aes(Date, value)) + geom_line(aes(color = series)) + xlab('Date') + ylab('Pembelian')
ggplot(new_sum_perum, aes(Date, value)) + geom_line(aes(color=series)) + xlab('Date') + ylab('Pembelian')




#Uji normalitas
normal_area_perum = sums[2:12]
normal_perum = sum_perum[2:34]

rnorm_area_perum = rnorm(normal_area_perum)
rnorm_perum = rnorm(normal_perum)


#Uji normalitas pada kedua dataframe menggunakan shapiro wilk test
#Ambil 2 kota saja
shapiro.test(normal_area_perum$`Inner London`)
shapiro.test(normal_area_perum$`Outer London`)

shapiro.test(normal_perum$City.of.London)
shapiro.test(normal_perum$Barking...Dagenham)

#T-test
t.test(rnorm_area_perum, rnorm_perum)

qqnorm(normal_area_perum$`Inner London`)
qqnorm(normal_area_perum$`Outer London`)

qqnorm(normal_perum$City.of.London)
qqnorm(normal_perum$Barking...Dagenham)
